<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>NORSAR Machine Learning Workshop, Sept 17-18 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-958fc32383290b5ef6234cdb9c3ce2d8.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-671bb9134f40f2663f70c3036e66f43e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./" class="navbar-brand navbar-brand-logo">
    <img src="./NORSAR-main-logo-RGB.png" alt="" class="navbar-logo">
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#before-the-workshop" id="toc-before-the-workshop" class="nav-link active" data-scroll-target="#before-the-workshop"><span style="color: #AD1457;">Before the workshop</span></a></li>
  <li><a href="#agenda" id="toc-agenda" class="nav-link" data-scroll-target="#agenda">Agenda</a></li>
  <li><a href="#sec-background" id="toc-sec-background" class="nav-link" data-scroll-target="#sec-background">Background material</a>
  <ul class="collapse">
  <li><a href="#selected-norsar-ml-works" id="toc-selected-norsar-ml-works" class="nav-link" data-scroll-target="#selected-norsar-ml-works">Selected NORSAR ML works</a></li>
  </ul></li>
  <li><a href="#sec-technical" id="toc-sec-technical" class="nav-link" data-scroll-target="#sec-technical">Technical things</a></li>
  <li><a href="#post-read-and-other-material" id="toc-post-read-and-other-material" class="nav-link" data-scroll-target="#post-read-and-other-material">Post-read and other material</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">NORSAR Machine Learning Workshop,<br>Sept 17-18 2025</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Welcome to the 2025 workshop on machine learning (ML) in seismology, where we will learn, try out, and develop ML tools for use at NORSAR.</p>
<p>Slides, exercises and other material will be kept on this webpage for later reference. If you have suggestions for additions or improvements, submit a <a href="https://github.com/smaeland/norsar-ml-workshop/pulls">pull request</a>!</p>
<section id="before-the-workshop" class="level2">
<h2 class="anchored" data-anchor-id="before-the-workshop"><span style="color: #AD1457;">Before the workshop</span></h2>
<p>To make the workshop as productive as possible, we encourage everyone to go through the following beforehand:</p>
<ul class="task-list">
<li><p><label><input type="checkbox"><strong>Test</strong> that you have a setup that can run the exercises. We aim to run everything online in <em>Google Colab</em>, which requires a Google account, but nothing more. To complete the test, click <a href="https://colab.research.google.com/github/smaeland/norsar-ml-workshop/blob/main/0_setup_test.ipynb">here</a> to open our first exercise, and click through it (takes 2 min, tops). If you do not have/want a Google account, take a look at the other options listed in <a href="#sec-notebooks" class="quarto-xref">Section&nbsp;4.0.3</a>.</label></p></li>
<li><p><label><input type="checkbox"><strong>Read</strong> some of the background material in <a href="#sec-background" class="quarto-xref">Section&nbsp;3</a>, especially the first of the review articles, to get some inspiration to what tasks can be solved with modern machine learning.</label></p></li>
<li><p><label><input type="checkbox"><strong>Think</strong> about topics or ideas to you would like to discuss or even prototype during the workshop. Around half of day 2 will be dedicated to exploring new projects.</label></p></li>
</ul>
<section id="optional" class="level5">
<h5 class="anchored" data-anchor-id="optional">Optional</h5>
<p>In addition to the points above, it will be helpful for the exercises we have planned to take a look at the technical stuff in <a href="#sec-technical" class="quarto-xref">Section&nbsp;4</a>, and run though the various tutorials to get comfortable with Python and its libraries. We will do a quickstart on the first day of the workshop as well, but doing it beforehand is a lot more efficient.</p>
</section>
</section>
<section id="agenda" class="level2">
<h2 class="anchored" data-anchor-id="agenda">Agenda</h2>
<p>Both days will take place in Maskinhallen. The agenda will most likely change a bit up until Wednesday, but the start and end times are absolute.</p>
<p><em><strong>Remote participation:</strong></em> Teams link can be found in the meeting invitation.</p>
<section id="wednesday" class="level4">
<h4 class="anchored" data-anchor-id="wednesday">Wednesday</h4>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td>9.00</td>
<td>Intro</td>
<td><a href="./slides/day1.html">Slides</a></td>
</tr>
<tr class="even">
<td>9.30</td>
<td>Exercise: Event detection</td>
<td>Notebook: <a href="https://colab.research.google.com/github/smaeland/norsar-ml-workshop/blob/main/1_event_detection.ipynb">Colab</a> or <a href="https://github.com/smaeland/norsar-ml-workshop/blob/main/1_event_detection.ipynb">download</a></td>
</tr>
<tr class="odd">
<td>10.00</td>
<td>Post-exercise: Understanding what we did</td>
<td><a href="./slides/day1.html">Slides</a></td>
</tr>
<tr class="even">
<td>11.00</td>
<td>Exercise: Event classification</td>
<td>Notebook: <a href="https://colab.research.google.com/github/smaeland/norsar-ml-workshop/blob/main/2_event_classification.ipynb">Colab</a> or <a href="https://github.com/smaeland/norsar-ml-workshop/blob/main/2_event_classification.ipynb">download</a></td>
</tr>
<tr class="odd">
<td>11.45</td>
<td>‚ú®Special‚ú® lunch</td>
<td></td>
</tr>
<tr class="even">
<td>12.30</td>
<td>Discussion</td>
<td></td>
</tr>
<tr class="odd">
<td>13.00</td>
<td>End of day 1</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="thursday" class="level4">
<h4 class="anchored" data-anchor-id="thursday">Thursday</h4>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td>9.00</td>
<td>Recap from yesterday</td>
<td></td>
</tr>
<tr class="even">
<td>9.15</td>
<td>Deep learning tools</td>
<td>Slides: <em>coming</em></td>
</tr>
<tr class="odd">
<td>9.30</td>
<td>Exercise: Training deep learning models</td>
<td>Notebook: <em>coming</em></td>
</tr>
<tr class="even">
<td>10.00</td>
<td>Post-exercise: Finding the optimal model</td>
<td>Slides: <em>coming</em></td>
</tr>
<tr class="odd">
<td>10.30</td>
<td>Recent and future ML at NORSAR</td>
<td></td>
</tr>
<tr class="even">
<td>11.00</td>
<td>Hackathon</td>
<td></td>
</tr>
<tr class="odd">
<td>11.45</td>
<td>Lunch (kantinen)</td>
<td></td>
</tr>
<tr class="even">
<td>12.30</td>
<td>Wrap-up and discussions</td>
<td></td>
</tr>
<tr class="odd">
<td>13.00</td>
<td>End of day 2</td>
<td></td>
</tr>
</tbody>
</table>
<!-- Wednesday: [Slides](slides/lecture1.qmd) -->
<!-- Thursday: [Slides](slides/lecture2.qmd) -->
</section>
</section>
<section id="sec-background" class="level2">
<h2 class="anchored" data-anchor-id="sec-background">Background material</h2>
<p>These review articles give a fairly comprehensive (although brief) overview of machine learning applications in seismology:</p>
<ul>
<li>Old but gold: <a href="https://pubs.geoscienceworld.org/ssa/srl/article-abstract/90/1/3/566430/Machine-Learning-in-Seismology-Turning-Data-into">Machine Learning in Seismology: Turning Data into Insights</a>, Q. Kong et al., 2019 (direct link to <a href="pdfs/emerging-topics-srl.pdf">PDF</a>)</li>
<li>More recent, with relatively narrow scope: <a href="https://www.annualreviews.org/content/journals/10.1146/annurev-earth-071822-100323">Machine Learning in Earthquake Seismology</a>, S.M. Mousavi and G. C. Beroza, 2023 (direct link to <a href="pdfs/annurev-earth-071822-100323.pdf">PDF</a>)</li>
<li>Relatively recent, with wider scope: <a href="https://www.science.org/doi/full/10.1126/science.abm4470">Deep-learning seismology</a>, S.M. Mousavi and G.C. Beroza, 2022</li>
</ul>
<p>For a beginner-friendly, hands-on book on deep learning, <a href="https://www.google.com/search?q=chollet+deep+learning">Deep Learning with Python</a> by F. Chollet is an absolutely great resource.</p>
<section id="selected-norsar-ml-works" class="level3">
<h3 class="anchored" data-anchor-id="selected-norsar-ml-works">Selected NORSAR ML works</h3>
<p>As you know, NORSAR has made strong contributions to the field, documented for instance by these works:</p>
<ul>
<li><p><a href="https://academic.oup.com/gji/article/239/2/862/7740467">Deep learning models for regional phase detection on seismic stations in Northern Europe and the European Arctic</a> (code available on <a href="https://github.com/NorwegianSeismicArray/tphasenet">GitHub</a>)</p></li>
<li><p><a href="https://academic.oup.com/gji/article/240/1/1/7817994">Self-supervised learning of seismological data reveals new eruptive sequences at the Mayotte submarine volcano</a></p></li>
<li><p><a href="http://seismica.library.mcgill.ca/article/view/1166">Monitoring urban construction and quarry blasts with low-cost seismic sensors and deep learning tools in the city of Oslo, Norway</a></p></li>
<li><p><a href="https://pubs.geoscienceworld.org/ssa/bssa/article-abstract/113/6/2345/627723/ArrayNet-A-Combined-Seismic-Phase-Classification?redirectedFrom=fulltext">ArrayNet: A Combined Seismic Phase Classification and Back‚ÄêAzimuth Regression Neural Network for Array Processing Pipelines</a> (code available on <a href="https://github.com/NorwegianSeismicArray/arraynet">GitHub</a>)</p></li>
<li><p><a href="https://academic.oup.com/gji/article/232/1/274/6661419">Predicting infrasound transmission loss using deep learning</a></p></li>
<li><p><a href="https://quentinbrissaud.github.io/images/2023.05.04_Brissaud_Ukraine_ML_Sandia.pdf">Seismic and infrasound monitoring of military conflicts using machine learning</a></p></li>
<li><p><a href="https://academic.oup.com/gji/article/230/2/1305/6551899">Enhancing seismic calving event identification in Svalbard through empirical matched field processing and machine learning</a></p></li>
</ul>
<p>Note that we have a bit of a tradition for open-sourcing the code used to produce results, made available on the NORSAR <a href="https://github.com/NorwegianSeismicArray">GitHub</a> and the Zenodo platform.</p>
</section>
</section>
<section id="sec-technical" class="level2">
<h2 class="anchored" data-anchor-id="sec-technical">Technical things</h2>
<p>During the workshop we will do various hands-on exercises, most of which benefit from some experience with programming. Luckily, the de-facto programming language for machine learning is <em>Python</em>, which is relatively easy to get started with.</p>
<p>There are three pieces of tech we will be using:</p>
<ol type="1">
<li><strong>Python</strong>, the programming langage,</li>
<li>Python <strong>libraries</strong>, containing code to actually do stuff, and</li>
<li><strong>Jupyter notebooks</strong>, which is a convenient way of running Python.</li>
</ol>
<p>The magic of 3. is that you <strong><em>do not need to install anything</em></strong>, instead we run the code online, in a browser. Below follows an introduction, and some reference material, to the three.</p>
<section id="python" class="level4">
<h4 class="anchored" data-anchor-id="python">Python</h4>
<p>If you already have some coding background in a different language, the <a href="https://realpython.com/cheatsheets/python/">Python cheat sheet</a> gives the essential overview of the language, while the official <a href="https://docs.python.org/3/tutorial/">tutorial</a> goes in depth.</p>
<p>If you have less programming experience, Google‚Äôs <a href="https://developers.google.com/edu/python">Python course</a> is quite nice, or in case you would like something in video format, Microsoft has made a <a href="https://learn.microsoft.com/en-us/shows/intro-to-python-development/">Python for beginners</a> video series.</p>
<p>However, in the end we can get away with limited Python knowledge, since the majority of our interaction with both the data and the ML models is through the set of libraries decribed below. And, given the modern tools at our disposal, we can always <a href="https://chatgpt.com/">ask for help</a>.</p>
<blockquote class="blockquote">
<p><em>Hey ChatGPT, I already know Matlab, can you give me a super-short (like, really short) introduction to Python?</em></p>
</blockquote>
</section>
<section id="required-python-libraries" class="level4">
<h4 class="anchored" data-anchor-id="required-python-libraries">Required Python libraries</h4>
<p>The main data structure we use for data-intensive tasks like ML is the <em>array</em>, provided by the <a href="https://numpy.org/">NumPy</a> (<em>Num</em>erical <em>Py</em>thon) library. It looks like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> a <span class="op">=</span> np.array([[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]])</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> a</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>array([[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>       [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]])</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> a.shape</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>(<span class="dv">2</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and allows for performing operations on each element <em>without</em> writing explicit <code>for</code>-loops:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> a <span class="op">+</span> <span class="dv">10</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>array([[<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>],</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>       [<span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>While we will cover some NumPy basics during the workshop, the essentials are given in these two tutorials: <a href="https://numpy.org/doc/stable/user/quickstart.html">NumPy quickstart</a>, for those who are already familiar with Python, and <a href="https://numpy.org/doc/stable/user/absolute_beginners.html">NumPy basics for beginners</a> for ‚Ä¶ well, beginners.</p>
<p>To perform all the computations involved in doing deep learning, we need a library that can do automatic differentiation and efficient matrix multiplications. A popular option is TensorFlow and its companion interface for building neural networks, <a href="keras.io">Keras</a>. A nice thing about Keras is the extensive <a href="https://keras.io/examples/">example gallery</a>, which serves as inspiration for solving loads of different tasks. While other options for deep learning frameworks have their benefits too, they mostly all follow similar syntax for data operations as NumPy, making it relatively easy to switch between them, as long as one knows NumPy.</p>
</section>
<section id="sec-notebooks" class="level4">
<h4 class="anchored" data-anchor-id="sec-notebooks">Jupyter notebooks</h4>
<p>Jupyter notebooks form a convenient way of prototyping code, by mixing code, text and graphics in a single document. The easiest option for running the exercise notebooks is through a cloud service, in which case there is nothing to install. Alternatives are (choose one):</p>
<ul>
<li><a href="https://colab.research.google.com/">Google Colab</a> <strong>(Preferred)</strong>: Requires a Google account (like GMail), but otherwise free.</li>
<li><a href="https://www.kaggle.com/code">Kaggle Code</a>: Requires an account, but otherwise free.</li>
<li>Install on our own machine: No accounts required, but setup may take a few minutes. Instructions are given in the <a href="https://docs.jupyter.org/en/latest/install/notebook-classic.html">Jupyter docs</a>.</li>
</ul>
<p>The notebooks are mostly self-explanatory, but the basics are also given in the <a href="https://www.kaggle.com/code/jhoward/jupyter-notebook-101">Jupyter Notebook 101</a> course, and documented in detail on the <a href="https://docs.jupyter.org/en/latest/">Jupyter website</a>.</p>
</section>
</section>
<section id="post-read-and-other-material" class="level2">
<h2 class="anchored" data-anchor-id="post-read-and-other-material">Post-read and other material</h2>
<p>Here we will collect workshop material for future reference üíæ.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>